---
tИТle: 'Instrumentation and ObservabilИТy'
date: '2023-05-13'
draft: true
---

## Инструментирование упаковки и зависимостей

Следующая часть процесса --- это сами артефакты сборки. Как и инструментирование
разработки, полученная информация в основном полезна для технических команд.
Интересно, что относительно мало людей уделяют время изучению структуры этих
артефактов, способов их использования и подробностей их зависимостей.
Большинство просто помещают их на сервер или в хранилище без возможности
отслеживания.

Лично я предпочитаю размещать артефакты в репозитории, где они могут быть более
чисто версионированы, и где можно оставлять идентификаторы задач, информацию о
сборке и другие заметки. Это также место, где я предпочитаю уведомлять различные
инструменты автоматизации о любых обновлениях, которые могут быть использованы
для запуска следующих шагов процесса доставки. Многие инструменты для сборки и
оркестрации позволяют настраивать поиск такой информации. Это обеспечивает
дополнительную прослеживаемость артефакта как вверху, по цепочке сборки к коду и
идентификаторам задач, так и внизу, по цепочке развертывания. Также полезным
сигналом является использование меток для автоматических систем развертывания,
чтобы инициировать обновление целевой среды развертывания. При полном управлении
программным обеспечением и конфигурациями сред разработки в полностью
отслеживаемом и автоматизированном режиме также можно отслеживать пакеты с
такими условиями.

При правильной реализации все данные должны быть доступны для запросов и
отображения на панели управления в дальнейшем.

Помимо информации, связанной с конкретной версией артефакта, есть несколько
важных факторов, которые стоит учитывать и отражать в отчётах:
* **Насколько атомарны мои пакеты?** Атомарные пакеты означают, что вы можете
  применять и удалять их в любой среде с небольшим риском того, что они оставят
  следы или иным образом изменят среду таким образом, что это не сможет быть
  автоматически отменено.
* **Насколько мои пакеты независимы от среды?** Многие организации привыкли
  создавать разные пакеты для разработки, тестирования и продакшена. Это
  нехорошая привычка, так как она создает потенциальные <<неизвестности>>,
  которые могут вызвать проблемы. Эти различия следует преобразовать в параметры
  конфигурации или флаги, которые можно будет установить при установке или
  запуске. Если есть причина, по которой это невозможно сделать, и такие
  различия действительно неизбежны, убедитесь, что пакеты, зависящие от среды,
  отражены в отчете вместе со своими причинами, потенциальными рисками и
  способами их тестирования и смягчения.
* **Какие зависимости имеют мои пакеты?** Зависимости --- это неприятные вещи,
  которые часто не получают должного внимания. Это особенно верно, когда они
  внешние, или, что еще хуже, получены через что-то вроде NPM или Maven. Эти
  зависимости должны быть учтены и отражены в отчете, с применением смягчающих
  мер, где это возможно, например, иметь локальные копии, чтобы избежать их
  исчезновения или скрытых проблем.

Каждый из этих факторов направлен на выявление и отслеживание уровня вашей
подверженности потенциальным <<неизвестностям>>. Обычно я размещаю эти вопросы
на панели управления или вики, чтобы каждый мог быть в курсе их состояния и
того, насколько хорошо они в настоящее время управляются. Целью должно быть
минимизировать эти риски, либо устранить их, либо выделить их опасность.

## Instrumenting Tooling (???)

Увеличение зависимости от инструментов и автоматизации, в целом, является
положительным явлением. Когда это реализовано правильно, оно снижает
вариативность и заставляет нас задуматься о способах сделать нашу экосистему
более повторяемой. Но сколько из нас **instrument our tooling (???)** для сбора
и отслеживания того, что было сделано с ним, как он работал и каковы были
конечные результаты? Сколько из нас создают прослеживаемые связи между
действиями инструментов, использованными или взаимодействующими с ними
артефактами и любыми задачами, стоящими за их запуском?

Сбор такой информации очень полезен, особенно для тех, кто сильно полагается на
ожидаемую производительность **tooling (???)** и того, насколько хорошо он
выполняет свою работу. Если вам не повезло и **tooling** вышел из строя или
начал работать неправильно, причем в результате ваша экосистема оказалась в
полном беспорядке, то вы, вероятно, знаете, насколько полезными являются записи
о том, что произошло и почему, для устранения последствий и предотвращения
подобных ситуаций в будущем. Я видел много случаев, когда системы мониторинга
перегружались и не предоставляли своевременных отчетов. Я также обнаруживал
случаи, когда инструменты сборки, резервное копирование и другие процессы
обслуживания ломались незаметным способом, который не обнаруживался до
наступления катастрофы.

Инструментирование может помочь обнаружить несоответствия до того, как они
станут проблемами. Оно также может помочь обнаружить потенциальные улучшения и
оценить их возможную ценность. Хорошей практикой является регулярное
планирование обзора инструментирования и отчетности, чтобы команды привыкли
анализировать, насколько хорошо они понимают, что происходит с **tooling**, а
также чтобы выявить области, где инструментирование было пропущено или оказалось
недостаточно эффективным для проактивного обнаружения ухудшающихся условий.
Часто это помогает команде обнаружить несоответствия внутри или между различными
инструментами, а также места, где оно было неправильно интерпретировано, и где
можно провести улучшения.

## Инструментирование изменений среды и управления конфигурацией

Очень распространенной и обычно хорошей практикой в ИТ является создание заявок
на изменение при внесении изменений в производственную среду. Это создает
полезную запись, позволяющую знать, когда были внесены изменения, кто их внес,
что было изменено и почему. 

Но сколько из нас на самом деле подробно фиксируют, что было сделано, как именно
это было сделано и какие различия между исходным и новым состояниями? Сколько из
нас регулярно обращаются к записям об изменениях для сравнения текущей или
прошлой динамики экосистемы с внесенными изменениями?

Как поставщик услуг, изменения, которые вы вносите, пожалуй, являются самой
заметной и важной деятельностью, которая влияет на динамику экосистемы. Поэтому
важно фиксировать изменения, а также различия между существующим и новым
состоянием конфигурации. Это очень важно для создания общего осознания и помощи
в устранении любых последующих инцидентов, вызванных изменениями, таким образом,
что корневая причина может быть понята. Документирование изменений в таком виде
настолько важно, что я всегда настоятельно рекомендую командам размещать ссылки
на детали последних пяти-десяти изменений на главной странице любого инструмента
для отчетности об инцидентах. Я раз за разом обнаруживал, что это помогает не
только тем, кто разбирается в инциденте, сократить время восстановления, но
также помогает тем, кто участвовал в изменении, более лаконично решить любые
корневые причины.

К сожалению, большинство команд по внедрению плохо справляются с полным
фиксированием подробностей любого изменения таким образом, чтобы это
поддерживало общее осознание состояния экосистемы и могло использоваться как
полный аудиторский след. Это часто делается настолько плохо, что многие
операционные команды сопротивляются частым изменениям в производственной среде.

Самым распространенным способом упущения информации об изменениях является
выполнение изменений вручную. Такие неотслеживаемые ручные изменения иногда
возникают, когда людям приходится вмешиваться для устранения проблем и заставить
все работать. Иногда используется коммерческое программное обеспечение, которое
требует выполнения изменений вручную через административные консоли или другие
сложные для автоматизации механизмы. В обоих случаях детали часто упускаются, и
их следует минимизировать или фиксировать всякий раз, когда это возможно. Я
видел команды, которые сохраняют историю командной строки или используют
сценаризированные (**scripted (???)**) тестовые инструменты, которые могут
управлять графическими интерфейсами для создания более повторяемой и
прослеживаемой записи изменений.

Еще одной удивительно распространенной проблемой является ситуация, когда работа
автоматизирована, но инструменты, выполняющие изменения, не фиксируют предыдущее
состояние конфигурации и то, что произошло при выполнении изменений. Некоторые
не проверяют конечный результат изменения, чтобы убедиться, что он соответствует
ожиданиям. Я лично видел инструменты развертывания, которые перемещали файлы или
символические ссылки, добавляли что-то в файлы конфигурации и подобное,
перемещали контейнеры, и затем объявляли успех, не проверяя, действительно ли
выполненные действия привели к ожидаемому результату. В некоторых случаях
инструменты игнорировали ошибки, от конфликтов разрешений до того, что файлы
либо не находились там, где ожидалось, либо были неполными, и переходили к
следующему шагу. Иногда API-интерфейсы сервисов не запускались должным образом
или давали неожиданные ответы. Даже когда ошибки записываются, мало кто обращает
на них внимание, пока что-то не взорвется, если вообще обращают.

Возможно, самой большой и наиболее распространенной проблемой является то, что,
в то время как мы можем отслеживать изменения, внесенные в производственные
сервисы, очень немногие из нас делают то же самое для тестовых и разработческих
сред, а также для изменений, внесенных в поддерживающие сервисы, такие как
сервисы мониторинга или резервного копирования. На самом деле, чрезвычайно
распространено, что все эти изменения вносятся без отслеживания.

Другая проблема заключается в том, что немногие из нас действительно фиксируют и
сравнивают конфигурации, существующие в разработке, тестировании и продакшене,
чтобы проанализировать их различия и понять, как эти различия могут создавать
разные динамики в каждой из сред. Проходил ли пакет через разработку и
тестирование перед отправкой в продакшен? Если нет, был ли он установлен в них
позже? Это не означает, что конфигурации в разработке и тестировании должны быть
точно такими же, как в производстве, или даже что они должны иметь одинаковую
конфигурацию друг с другом. В большинстве случаев это почти невозможно. Однако
признание наличия различий не означает, что необходимо игнорировать
существование этих различий, или не проверять и не учитывать, как они могут
изменять поведение. Пропускание или игнорирование этих различий создает лишние и
часто проблематичные неизвестные факторы.


Фиксация, отчетность и анализ такой информации позволяют вам гораздо лучше
понять, что имеется внутри вашей среды. Создание связей между всеми артефактами
и действиями, от заявок на задачу до заявок на изменение в конечной точке цикла,
позволяет вам, начиная с любой точки, проследить всю вашу экосистему, чтобы
понять и восстановить контекст происходящего в ней.

## Инструментирование тестирования

При правильной организации тестирования можно получить множество полезной
информации. Оно может предоставить различные идеи и представления, превышающие
выявление потенциальных рисков, вызванных дефектами в коде. Одним из наиболее
важных способов использования инструментирования тестирования для улучшения
общего понимания экосистемы является возможность захвата того, как изменения в
сервисе вероятно будут вести себя в целевой операционной среде.

Использование автоматизированных инструментов тестирования и инструментации в
этом контексте может показаться неособо заметным или даже простым
перефразированием того, что, как считается, делают команды по тестированию.
Однако отличие состоит в том, что это не направлено на <<обеспечение качества>>.
Во-первых, концепция QA оказывается недостаточно эффективной. Она не дает много
гарантий. В основном она сообщает вам, какие ошибки были обнаружены во время
тестирования, и, вероятно, существуют другие ошибки, которые просто не были
обнаружены.

Это не означает, что такое тестирование не нужно проводить. Вместо этого
тестирование должно быть ориентировано на улучшение понимания того, как сервисы
будут вести себя в различных сценариях и условиях, чтобы улучшить вашу
способность эффективно реагировать на различные поведения сервисов. Тестирование
также должно помочь вам лучше понять, какие условия вероятно возникают при
определенных поведениях сервиса.

Я также предпочитаю использовать тестирование для более полного выявления
проблемного кода, обнаруженного при помощи инструментации разработки. Это
помогает выявить больше деталей <<размера выгоды>>, инвестируя в рефакторинг или
более полную переработку проблемной области.

Для максимальной полезности инструментирования тестирования я рекомендую
интегрировать его с инструментарием мониторинга и анализа работы продуктивной
среды (**augment ИТ wИТh production instrumentation tooling whenever possible
(???)**), и наоборот. Это включает использование инструментов мониторинга,
анализа логов, неразрушающего тестирования, синтетических транзакций и других
подобных инструментов для осуществления прямых сравнений. Путем предоставления
информации о тестовых случаях и их результатов, а также сравнения с
производственной средой, можно настроить как тестовое, так и операционное
инструментирование. Это позволяет анализировать и сравнивать правильные динамики
в будущих сценариях.

Кроме того, ценно зафиксировать и документировать различия в конфигурации
развертывания между тестовыми и производственными средами. В документации
следует также отразить любые отличия в поведении и производительности,
возникающие из-за этих различий в конфигурации. Понимание и отслеживание таких
различий позволяют иметь большую уверенность в том, какие настройки могут быть
изменены, когда подобные условия возникают в производственной среде.

## Инструментирование продакшена

Внедрение инструментирования в продакшен является разумным подходом, и,
вероятно, именно поэтому вы решили прочитать эту главу. Продакшен является
особенно важной для обеспечения наблюдаемости вашей экосистемы. Это место, где
ваши пользователи взаимодействуют с вашими сервисами, и поэтому именно здесь вы
должны искать понимание того, как эти сервисы помогают пользователям достигать
своих целевых результатов. Многие организации осознали это, и это привело к
большому интересу и инвестициям в решения Big Data-аналитиков.

Однако часто пропускается то, что для построения точного уровня понимания этой
динамики в наиболее всестороннем и эффективном способе требуется больше, чем то,
что может быть сделано с использованием традиционных подходов к мониторингу и
ведению журналов. Это верно даже при использовании современных аналитических
инструментов Big Data.

Если ваша цель заключается в том, чтобы улучшить понимание экосистемы продакшена
для принятия более эффективных решений, то стоит обратить внимание на ряд
областей инструментального обеспечения, которые часто упускаются из виду, как
описано в следующих разделах.

## Запрашиваемый/отчетный оперативный код и сервисы

Одна из самых больших проблем, связанных с бессерверными сервисами и тому
подобным, заключается в том, что инструментировать и отслеживать их
традиционными способами не так-то просто. Один из лучших способов преодолеть это
--- напрямую разместить в ваших сервисах перехватчики с возможностью запроса,
которые могут дать вам представление о том, что происходит.

Вам не нужно иметь особо продвинутые перехватчики, чтобы начать. Даже такой простой перехватчик, который реагирует на флаг, спрашивающий <<Ты жив?>>, является
полезным началом. Это можно легко расширить до <<Каковы ваши показатели
здоровья?>> вплоть до дополнительной информации, подобной отладочной, такой как
<<Что происходит с этими пользователями/сеансами/данными при их прохождении
через сервис?>> Другие способы инструментировать и отслеживать происходящее --- это
использовать такие инструменты, как Java Management Extensions (JMX), или
заставлять службы регистрироваться самостоятельно и отправлять регулярные
метрики в виде pub / sub на центральную шину или точку, где они могут быть
собраны и проанализированы.

Ни один из этих подходов не является особенно сложным в реализации. Что делает
такие возможности полезными, так это то, что их внедрение и использование может
значительно снизить сложность и временные задержки, возникающие при попытке
сделать то же самое с помощью более традиционного механизма логгирования.
Возвращаемые значения могут быть приведены в соответствие с
применяемым стандартом, что позволяет быстро отображать значения на панели
управления для анализа, чтобы выявить любые различия между экземплярами
сервиса.

Если все сделано правильно, инструментирование сервисов и пользовательских
интерфейсов может позволить вам наблюдать за пользователями и пользовательскими
сеансами практически в режиме реального времени по мере их перемещения по
экосистеме сервисов. Это особенно удобная возможность при анализе проблем, с
которыми сталкивается один или небольшая группа пользователей.

## Совместное представление записей о задачах, изменениях, инцидентах и проблемах 

Многие поставщики инструментов управления сервисами говорят о том, что
преимущества использования их инструментальных экосистем заключаются в том, как
все взаимосвязано. Они будут включать в себя системы поиска ошибок с рабочими
процессами, базы данных управления конфигурацией (CMDBS) и даже мониторинг.
Проблема в том, что подавляющее большинство данных либо скрыто в отдельном
хранилище, либо их не особенно легко объединить в представления, полезные вам и
другим, кто в них нуждается.

Я обнаружил, что часто чрезвычайно полезно представлять всю эту информацию
вместе. Это особенно верно в отношении информации об изменениях, которая должна
быть немедленно доступна для просмотра любому, кто занимается исследованием
инцидента. Для этого я обычно предпочитаю использовать простую веб-страницу или
какой-либо другой столь же несложный механизм, который легко просматривается
независимо от того, находитесь ли вы в пути или сидите за своим рабочим столом.

Хотя сведение воедино записей об изменениях и инцидентах чрезвычайно важно, мне
также нравится искать способы легко проследить цепочку взаимосвязей из любой
точки моей экосистемы. Возможность начать, например, с пакета или конфигурации и
вернуться как к серии задач, которые их создали, так и перейти к тому, где и как
они были развернуты, чрезвычайно эффективна. Такой подход позволяет вам собрать
воедино информацию, которая может вам понадобиться, в нужном контексте и в
нужное время. Перекрестный посев (**cross-seeding (???)**), как упоминалось ранее, имеет решающее значение
для этого; однако упрощение его использования также означает, что он будет
использоваться гораздо интенсивнее. Ключом к этому является создание простой
системы, которая позволит вам легко перемещаться по экосистеме.

Еще одна полезная вещь, которую нужно сделать, --- это регулярно представлять
данные и тенденции, которые могут быть интересны технической и нетехнической
аудитории. Это может быть что угодно --- от неудачных изменений и аспектов
изменений, которые привели к неожиданному поведению сервиса, до инцидентов,
обработка которых заняла гораздо больше времени, чем обычно. Эта презентация
должна быть сделана таким образом, чтобы стимулировать улучшение, а не
превращаться в игру с обвинениями. Обвинение, как мы знаем, побуждает людей
скрывать данные и разрывать отношения. Я, как правило, направляю большую часть
отчетов тем, кто ближе к делу, но позволяю безукоризненно оформить их для
передачи высшему руководству, когда требуется помощь и поддержка.

## Конфигурация среды 

Ранее мы говорили об управлении конфигурацией и развертываниями. Но знаете ли вы
обо всем, что происходит в вашей экосистеме доставки? Знаете ли вы, как быстро и
последовательно вы можете перестроить и перераспределить каждую часть вашей
экосистемы доставки с нуля?

Знать, что у вас есть в вашей экосистеме доставки --- это нечто большее, чем
знать версии установленного программного обеспечения или очень простые элементы,
такие как сетевые адреса и тому подобное. Речь идет о том, чтобы точно знать и
регулярно пересматривать, из чего состоит экосистема. Я обнаружил, что лучший
способ распознать эту информацию --- это регулярно пересобирать как можно большую
часть вашей экосистемы.

Под <<пересборкой>> я подразумеваю нечто большее, чем перемещение нескольких
контейнеров или файлов на диске виртуальной машины (VMDKS). Я имею в виду
возможность переустановить полный стек, настроить его и запустить в
производство. Знание того, насколько быстро и последовательно вы можете это
делать, позволяет вам знать, сколько времени может потребоваться для
восстановления любого компонента в аварийной ситуации.

Пересборка также действует как катализатор для выявления ситуаций, когда в
процессе перестройки имеются отдельные точки сбоя. Возможность перестроить таким
образом также означает, что вам не нужно рассчитывать на какой-либо инструмент
обнаружения, который попытается изучить и отследить то, что у вас может быть,
если он вообще сможет это выяснить. Это также означает, что если вы столкнетесь
с нарушением безопасности, таким как атака программ-вымогателей, вы можете быть
уверены в том, какую часть стека вы сможете сбросить и восстановить заново, а
не потерять.

Другой важной частью отслеживания конфигурации среды является то, что вы можете
создать способ фиксировать и понимать, что меняется в вашей среде и как она
меняется. Это также позволяет вам быстро обнаруживать подозрительные или
несанкционированные изменения.

Я стараюсь искать возможности регулярно проводить пересборки, а также создавать панели управления, которые фиксируют точки трения и другие опасные точки,
которые команда может попытаться устранить. Они должны пересматриваться через
очень регулярные промежутки времени, по крайней мере, так же часто, как
стратегические обзоры, где можно ставить цели и предпринимать действия для
улучшения ситуации.

## Логгирование

Логгирование является традиционной и важной частью любой экосистемы; однако
как часто мы на самом деле просматриваем логи? Насколько они заслуживают
доверия, рассказывая нам то, что мы хотим знать? Насколько они структурированы и
удобочитаемы?

Я подхожу к логгированию с двух сторон: 
* ** Эксплуатационная полезность: ** Логи, которым не стоит доверять,
  которые трудно анализировать или которые просто не предоставляют никакой
  ценности, должны быть выделены. Что в них не является полезным, заслуживающим
  доверия или простым для анализа? Как это повлияет на оперативную поддержку?
  Сбор и просмотр этой информации позволит вам разобраться в ситуации. Иногда вы
  можете обнаружить, что существуют лучшие способы получения той же информации,
  или что существует так много ложного шума, что многое из того, что в данный
  момент регистрируется, следует отключить или настроить на более низкий
  уровень. Ведение логов --- определенно одно из тех мест, где у вас может быть
  слишком много, слишком мало и слишком неуместно.
* ** Долгосрочная полезность: ** Что передают логи и кто может использовать
  эту информацию? Существуют ли какие-либо юридические или нормативные правила,
  которые могут повлиять на их обращение или хранение? Легко ли их получить и
  обработать? Сколько времени требуется для приведения их в пригодную для
  использования форму и почему? Какова их точность? Выделение и отслеживание
  таких логов и их записей, особенно тех, которые важны или могут
  отличаться от потребностей тех, кто хочет использовать информацию, помогает
  выявить потенциальные задержки в информировании, которые могут снизить
  эффективность принятия решений.

## Мониторинг

Мониторинг --- это одна из тех вещей, которыми мы все занимаемся. В этом есть
смысл. Но так же, как и опасения по поводу инструментария обслуживания, которые
высказали мои друзья-DevOps инженеры, насколько полезен для вас весь мониторинг?
Всегда ли он своевременно сообщает вам то, что вам нужно знать, с достаточным
контекстом для действий?

Несмотря на то, что большая часть данных мониторинга, собираемых организациями,
в лучшем случае некачественна, многие из нас склонны считать, что чем больше,
тем лучше. Мы часто собираем оповещения и статистику, на которые почти никогда
не обращаем внимания, не говоря уже о том, чтобы использовать, в результате чего
системы мониторинга выглядят как цифровой эквивалент гаража барахольщика, полного
старых газет.

Лучший способ подойти к мониторингу --- это изучить его, чтобы определить не
только его точность, но и то, кто будет использовать данные, по какой причине и
какие решения они, вероятно, примут на их основе. Если существуют лучшие, более
точные или более своевременные способы, с помощью которых можно легко получить
информацию, то старый метод следует заменить новым, более совершенным. Если
мониторинг запускает оповещения, которые не просматриваются до тех пор, пока не
накопится несколько или не произойдет что-то еще, эту проблему следует
устранить. Получать слишком много бесполезной информации иногда хуже, чем не
получать ничего, поскольку это снижает вашу чувствительность к информации.

Настройка мониторинга должна быть частью регулярного тактического обзора. Это
следует делать, особенно после инцидентов, когда это было недостаточно
эффективно для того, чтобы помочь заблаговременно выявить проблемы до того, как
они вызовут проблемы. Также имеет смысл рассмотреть вопрос о том, как повысить
общую эффективность мониторинга при проведении стратегических обзоров.
Мониторинг необходимо последовательно настраивать и совершенствовать по мере изменения
динамики.

Следует также поощрять персонал к тому, чтобы он не привыкал к наращиванию
<<шумного>> или бесполезного мониторинга.

## Отслеживание и анализ безопасности 

Безопасность, как правило, является источником политик, создающих неудобства,
которые часто кажутся намного большими, чем ценность безопасности, которую они
обеспечивают. Однако в мире услуг безопасность необходима для защиты как вашей
организации, так и, в конечном счете, вашего клиента; однако у безопасности
также есть побочное преимущество, которое часто упускается из виду. Безопасность
может стать еще более мощным стимулом для сбора и отслеживания того, что
находится в вашей экосистеме. Это может быть использовано для лучшего понимания
поведения экосистемы, вызванного различными состояниями и действиями
пользователей, что может улучшить вашу общую осведомленность.

Многие методы обеспечения безопасности и инструментальные средства, как правило,
либо дополняют другие механизмы отслеживания, такие как журналы, отслеживание
конфигурации среды и тому подобное, либо имеют свои собственные
специализированные инструменты для мониторинга таких вещей, как специфический
трафик и угрозы. Эти механизмы ищут вещи, которые выглядят странными или
ненормальными, что может быть сделано двумя способами.

Вы можете использовать эти механизмы для поиска списка действий и состояний,
которые отражают известные угрозы безопасности и нарушения. Именно так поступает
большинство организаций, поскольку это довольно просто сделать, но полностью
полагаться на этот подход не стоит, поскольку по умолчанию предполагается, что
несанкционированного доступа не было. Это не лучшая позиция для большинства
организаций, особенно для тех, которые являются достаточно крупной или
интересной целью. Этот подход также не учитывает тот факт, что многие из
наиболее неприятных нарушений безопасности начинаются изнутри, либо со стороны
внутреннего злоумышленника, либо кого-то, чьи учетные данные были каким-либо
образом скомпрометированы.

Другой способ приблизиться к безопасности --- попытаться зафиксировать и
отслеживать состояние и действия как можно большей части вашей операционной
экосистемы. Это включает в себя отслеживание изменений конфигурации и данных,
сетевого трафика и тому подобного, оставляя вокруг заманчивые приманки, чтобы
попытаться заманить злоумышленников узнать о них больше, чтобы вы могли лучше
защитить наиболее чувствительные части вашей экосистемы.

Чтобы иметь возможность отслеживать эту информацию, фиксируйте и отслеживайте
конфигурацию и вносимые вами изменения, чтобы вы могли легко запрашивать и
проверять наличие любых неизвестных различий. Это должно отражать как
потенциальные угрозы безопасности, так и поведение (будь то от ошибочных
инструментов или незарегистрированных процессов), которые не отслеживаются.

Основные моменты таких данных должны быть видны, чтобы помочь командам и
организации совершенствоваться.

## Сервисные данные

Последняя область, которую вам следует рассмотреть, состоит из структуры,
хранения и доступности сервисных данных. Сюда входят как данные о клиентах, так
и другие формы данных, используемые для управления вашими услугами.

Несмотря на то, что большинство программ обработки больших данных ориентированы
на интенсивный анализ сервисных данных, относительно немногие организации тратят
много времени на размышления об общей архитектуре и структуре имеющихся у них
данных, помимо того, что абсолютно необходимо для управления сервисами. Такие
данные неизбежно органично разрастаются в различные кучи, разбросанные по
экосистеме. Это приводит к дублированию и несоответствиям, из-за которых данные
гораздо труднее собрать воедино и понять, чем то, что они представляют. Это
также затрудняет получение информации для анализа.

Чтобы уменьшить количество подобных проблем, лучше всего внедрить два механизма
в рамках вашего процесса доставки: 
* Иметь сменяющуюся роль, которая создает архитектурную карту того, какие данные
  хранятся, где, каким образом и с помощью каких приложений и служб они
  используются, и владеет ею. Дубликаты и несоответствия должны быть обнаружены
  и устранены везде, где это возможно.
* С самого начала следует рассматривать архитектуру и дизайн данных как часть
  процесса доставки. Где должны храниться данные? Что должно получить к нему
  доступ? Были ли учтены дубликаты и сведены ли они к минимуму везде, где это
  возможно? Как могут быть извлечены данные, куда и с какой целью? Этот процесс
  не обязательно должен быть особенно тяжелым. Правда, гораздо легче
  управлять небольшими изменениями, чем более крупными.

## Собираем все воедино

Внедрение правильного инструментирования для донесения нужной информации до нужной
аудитории в соответствии с ее целями может показаться действительно сложным. С
чего вы начнете? Как вам удастся поддерживать это в рабочем состоянии? Как вы
будете совершенствоваться?

Иногда трудно увидеть наилучший путь продвижения вперед, особенно когда вы очень
близки к проблеме и привыкли к тому, как вы всегда поступали.

К счастью, это далеко не единственная отрасль, которая сталкивается с такого
рода проблемами с приборами. Многие другие отрасли промышленности нуждаются в
приборостроении, поскольку они также предъявляют высокие требования к
доступности, крайне непредсказуемому спросу и неумолимо высокой чувствительности
к отказам. Наблюдение за тем, как кто-то копирует в совершенно другом контексте,
часто может помочь вам сделать шаг назад и более объективно взглянуть на свой
собственный мир.

Отрасль, по которой мне лично нравится проходиться --- это та, с которой
большинство из нас взаимодействует почти каждый день, но о которой мало думают:
_сфера управления сточными водами_.

## Инструментирование экосистемы управления сточными водами

<!-- изображение здесь, стр.366 -->

Мало кто станет спорить с тем, что услуга, которая одновременно заботится о
ваших отходах и не допускает в ваш дом отходы вашего соседа, не важна. И все же,
сколько людей задумываются о сложностях построения такой системы и управления
ею?

У меня была возможность увидеть вблизи одну из таких систем, которыми управляет
город Лос-Анджелес. Запахи были предсказуемо неприятными, как и ежедневные
угрозы безопасности, которым подвергались сотрудники, работая рядом с
действующей сетью канализационных коллекторов, влажных колодцев, варочных котлов
и накопительных прудов. Но то, что большинство считало бы очень заурядным и
часто забываемым сервисом, вскоре оказалось совсем не таким.

Как и большинство городов, Лос-Анджелес предоставляет услуги водоснабжения и
канализации жителям и предприятиям через сеть труб и туннелей, проходящих по
всему городу. Люди не только ожидают, что их вода будет безопасной и все, что
попадает в канализацию, не вернется обратно, но и ожидают, что на улицах не
будет отходов. Канализационные коллекторы также являются местами, где без
активного мониторинга и рассеивания могут скапливаться вредные газы, создавая
опасные облака, а иногда и взрывоопасные условия.

Однако Лос-Анджелес сталкивается с гораздо большими проблемами, чем
среднестатистический муниципалитет. Большая столичная область занимает более
4800 квадратных миль засушливой и полузасушливой местности, пересекающей сложную
топологию гор и долин. Этот район подвержен как засухе, так и внезапным
наводнениям. И то, и другое вредно для канализационных систем. В первом случае в
трубах могут скапливаться отходы. Последнее может привести к переполнению систем
сбора отходов и стоков, в результате чего опасные объекты заполнят улицы, а
иногда даже дома людей. В довершение всего Лос-Анджелесу также приходится
бороться с дополнительными стихийными бедствиями, такими как землетрясения,
оползни и лесные пожары. Если это недостаточно сложно, системы водоснабжения,
канализации и ливневой канализации пересекаются с лабиринтом местных органов
власти, которые часто не сходятся во взглядах, не говоря уже о том, что у них
есть желание и средства для сотрудничества.

Несмотря на эти трудности, я стал свидетелем динамичной системы,
которая стала одной из самых передовых в мире, в действии. Мало того, что сточные воды на
улицах встречаются чрезвычайно редко, так еще и количество стоков и сбросов
отходов за последние годы сократилось более чем на 95%. Более того, система
улучшила качество воды и возможности ее доставки, снизила общее потребление воды
в реальном выражении и уменьшила количество зарастания береговой линии и других
экологических проблем. Это было достигнуто, несмотря на продолжающийся рост
населения и изменения во всем регионе.

Как это делает санитарное управление Лос-Анджелеса?

Во-первых, они поняли, что экосистема ни за что не выживет, если город
воспользуется подходом к созданию статичной конструкции сети труб в земле.
Один-единственный шторм или несанкционированный завод, незаконно сбрасывающий
опасные материалы в систему, может уничтожить значительные районы региона. Им
нужно было активно изучать экосистему и происходящие в ней изменения, постоянно
пытаясь найти новые способы улучшения.

Департамент по-прежнему был сосредоточен на достижении целевых результатов: не
допускать попадания сточных вод в дома и на улицы людей и свести к минимуму
опасность для здоровья и загрязнение окружающей среды, одновременно изыскивая
возможности для переработки и повторного использования воды. Они начали с того,
что попытались больше узнать об окружающей среде, в которой они работали. Они
разбросали датчики и провели тесты по всей сети и по всему региону. Это помогает
им понять, как вода течет на поверхности, под землей, а также по дренажным и
канализационным сетям. Они проверяют не только производительность и скорость
потока, но и отслеживают наличие опасных концентраций всего --- от взрывоопасных и
ядовитых газов до проблемных материалов, проходящих через систему. Они также
смотрят на то, как работает вся система, от канализационных коллекторов,
насосных станций и очистных сооружений до поведения людей, которые их используют
и эксплуатируют.

Такой мониторинг и отслеживание в корне отличаются от традиционного
ИТ-мониторинга и управления рабочим процессом обслуживания. В отличие от ИТ,
они не были сосредоточены в первую очередь на выявлении аномалий, на которые
нужно было реагировать. На замену ливневого канала или увеличение пропускной
способности канализации могут уйти месяцы или даже годы, из-за чего даже самый
отсталый процесс закупок ИТ кажется молниеносным. Вместо этого они выходят за
рамки ИТ, стремясь активно понимать и формировать саму экосистему. Информация
постоянно анализируется и используется для постоянного повышения эффективности
понимания сети каждым пользователем.

Такой подход и образ мышления не просто повышают оперативность реагирования на
возможные сценарии сбоев. Это позволяет выделить точки трения и зоны риска и
лучше их понять. Все, что угодно, от открытия новой фабрики до изменения
рецептуры широко используемого геля для ванн, может легко изменить динамику всей
сети. Они также изучают местную и региональную гидрологию и модели
поверхностного дренажа, чтобы понять и спрогнозировать потенциальные опасности
для стока. Активный сбор информации помогает получить еще более точное
представление об операционной среде и любых соответствующих закономерностях,
которые она может содержать. Это улучшает адресность всего - от улучшения
дорогостоящей инфраструктуры до изменений в местной политике и постановлениях.
Они даже заходят так далеко, что участвуют в планировании и позволяют понять,
как предлагаемые изменения могут повлиять на систему, предлагая решения, которые
помогают сохранить экосистему здоровой.

По мере того как усложнялась система, повышались и требования общественности к
сервису. Если воды так мало, можно ли собирать сточные воды и превращать их в
пригодные для повторного использования или даже питьевые? Можно ли каким-то
образом переработать отходы и направить их на полезное дело, которое уменьшит их
негативное воздействие на окружающую среду?

Округ старается соответствовать этим требованиям. Они постоянно рассматривают
возможность модернизации ливневой канализации, канализационных стоков и методов
подачи воды для максимального повторного использования воды. Улучшилась не
только очистка сточных вод, но и округ узнал, что они могут воспользоваться
некоторыми уникальными особенностями бассейна Лос-Анджелеса для улучшения
повторного использования воды. Большая часть Лос-Анджелеса расположена на
поверхности чередующихся водоносных горизонтов и нефти. Они поняли, что могут
уверенно закачивать переработанную серую воду в грунт в стратегически важных
местах, где состав почвы будет дополнительно очищать воду, одновременно пополняя
подземные водоносные горизонты, которые уже используются в качестве источников
питьевой воды. Это позволяет поддерживать местные источники воды, одновременно
стабилизируя грунт, чтобы снизить риски пропитания и проникновения соленой воды,
а также свести к минимуму подземные перемещения, которые потенциально могут
привести к землетрясению. Эти усилия были настолько успешными, что не только был
снижен уровень отходов, но и фактическое потребление воды сократилось в реальном
выражении, даже несмотря на рост населения.

Восстановление не заканчивается водой. Метан из сети улавливается и используется
для выработки электроэнергии, в то же время предпринимаются усилия по
переработке как можно большего количества остальных отходов. Это чрезвычайно
сложная задача, особенно с учетом того, что нет реального способа заставить
пользователей по всей экосистеме отчитываться о том, что они сбрасывают в
канализацию, не говоря уже о том, как и когда они используют сеть.

Результатом всех этих усилий является то, что те, кто управляет экосистемой,
чувствуют себя так, словно понимают <<биение сердца>> города. Они могут видеть
структуру использования каждый день, начиная с неуклонного увеличения потока из
жилых районов, когда люди встают утром, и заканчивая перемещением в офисные и
торговые парки, а также промышленные районы, когда люди идут на работу, и
обратно в жилые районы вечером. Аналогичным образом, рыночные тенденции и
сезонные особенности фабрик и офисов становятся очевидными по мере изменения
потоков и состава их содержимого. Даже воздействие общественных мероприятий и
погодных условий может быть идентифицировано и понято в шумовом сигнале других
событий, происходящих по всей сети.

Все эти наблюдения позволяют лучше ориентироваться и более активно реагировать
на изменения, помогая неожиданностям становиться все более редкими. Затем эти
знания могут быть использованы при городском планировании, зонировании и выдаче
разрешений, выявляя потенциальные проблемы до того, как у них появится шанс
нанести ущерб этой скрытой экосистеме.

## Инструментирование ИТ-экосистемы

Вы можете использовать тот же подход, описанный в предыдущем разделе, для
создания столь же глубокого понимания вашей ИТ-экосистемы.

Позднее в своей карьере я работал в компании, которая предоставляла широкий спектр
веб-сервисов и интернет-услуг. Ожидания в отношении производительности
и удобства использования значительно различались. Например, пользователи были
гораздо более чувствительны к отклику и проблемам с качеством потокового
мультимедиа, чем, скажем, к RSS-ленте. Однако между рынками существовали и
важные различия. Несоответствие этим ожиданиям оказало значительное негативное
влияние как на репутацию на рынке, так и на итоговый результат.

Будучи в значительной степени ориентированными на потребителя, многие из наших
сервисов также были уязвимы для экстремальных скачков трафика в стиле
<<Slashdot-эффекта>>. Были времена, когда трафик внезапно увеличивался в
1000-100000 раз по сравнению с нормальным потоком. Без достаточной доступной
инфраструктуры и быстрого реагирования все может быстро рухнуть. Однако
экономическое обоснование приобретения всех дополнительных мощностей не всегда
было четким. Было непомерно дорого иметь такой избыток, который большую часть
времени простаивал без дела, и поскольку эксплуатационные характеристики сервиса
со временем менялись, было даже неясно, будут ли мощности, приобретенные сейчас,
эффективно работать в будущем.

С таким количеством меняющихся переменных нам нужно было найти способы
использования инструментов для лучшего понимания динамики нашей экосистемы.

Что касается сервиса, мы начали встраивать хуки, которые позволяли нам изучать
работоспособность и эксплуатационные характеристики самих сервисов. Мы
сопоставили их с другими операционными инструментами, такими как журналы и
информация мониторинга, чтобы получить дополнительные сведения о том, как
различные события повлияют на динамику операционной экосистемы.

Мы также внедрили такие же инструменты в среду разработки и тестирования, где мы
искали те события и профили загрузки, которые могли бы создать проблемы с
производительностью. Это позволило нам затем разработать различные варианты,
которые могли бы быть у нас для решения подобных задач, от более традиционного
масштабирования емкости до отключения различных функций и превращения
определенных элементов в статические или кэшированные.

Затем мы начали измерять количество времени и вариативность, затрачиваемые на
реагирование на изменяющиеся события. Это включало время выполнения работ и
точность реагирования на событие, время и потенциальные риски, связанные с
изменением пропускной способности различных сервисных элементов, время и
сложность, связанные с отключением или изменением функций, время и потенциальные
проблемы с перемещением и восстановлением данных и тому подобное. Это дало нам
некоторое представление о наших затратах на задержку, которые можно было бы
использовать для определения направления инвестиций.

Еще одним элементом, который был важен для всего этого инструментария, было
понимание ожиданий клиентов и моделей использования. Несмотря на то, что никогда
не было легко определить грядущие скачки нагрузки или оценить удовлетворенность
клиентов обслуживанием, мы нашли ряд полезных подсказок, которые помогли.
Например, мы заметили четкие временные интервалы в течение дня, когда некоторые
сервисы использовались интенсивнее, чем другие. Мы также могли видеть ряд
признаков того, что клиенты были разочарованы качеством обслуживания.

Располагая всей этой информацией, мы начали искать места для оптимизации. Мы
начали в значительной степени автоматизировать нашу способность развертывать и
перенастраивать экземпляры служб, чтобы повысить скорость реагирования и
гибкость. Мы использовали шаблоны использования клиентов для динамического
перебалансирования пропускной способности различных сервисов в течение дня. Для
элементов с более высокими профилями трения, таких как данные, мы стремились
своевременно реплицировать и перемещать данные, чтобы повысить нашу
оперативность реагирования на потенциальные события.

Мы также регулярно проверяли качество и своевременность наших измерительных
данных. Это позволило нам постоянно настраивать то, что у нас было, находить
новые места для инструментов и получать достаточно точные показатели вероятной
окупаемости инвестиций (RoI) для такой работы. 

В конце концов, мы стали гораздо более чутко реагировать на изменения
экосистемы. Нам также удалось улучшить наши общие показатели использования,
чтобы максимизировать отдачу от наших инвестиций в инфраструктуру и развитие.
Более активная деятельность также значительно повысила моральный дух и
креативность команды.

## Подводя итоги

Инструментирование вашей экосистемы доставки таким образом, чтобы сделать ее
динамику заметной, имеет решающее значение для обеспечения ситуационной
осведомленности, необходимой для принятия решений. Но чтобы делать это
эффективно, вам нужно понимать, какие данные являются нужными для аудитории,
потребляющей их, и для чего они их потребляют. Мы, ИТ-специалисты, делаем много
вещей, которые затрудняют это, от накопления неверных данных до сбора данных,
искаженных из-за недостаточной точности, своевременности и предвзятости. Создав
правильные инструменты и механизмы проверки в своей экосистеме, вы сможете
обнаружить и свести к минимуму эти искажения, чтобы встать на правильный путь.